<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <include file="changelog/01-create-speciality-table.xml" relativeToChangelogFile="true"/>
    <include file="changelog/02-fill-speciality-table.xml" relativeToChangelogFile="true"/>
    <include file="changelog/03-metadata-field.xml" relativeToChangelogFile="true"/>
    <include file="changelog/04-add-law-speciality.xml" relativeToChangelogFile="true"/>
    <include file="changelog/05-add-applied-math-speciality.xml" relativeToChangelogFile="true"/>

    <changeSet id="6" author="Igor Marchenko">
        <addColumn tableName="faculty">
            <column name="uuid" defaultValueComputed="gen_random_uuid()" type="UUID"/>
        </addColumn>
        <addColumn tableName="chair">
            <column name="uuid" defaultValueComputed="gen_random_uuid()" type="UUID"/>
        </addColumn>
        <addColumn tableName="speciality">
            <column name="uuid" defaultValueComputed="gen_random_uuid()" type="UUID"/>
        </addColumn>
    </changeSet>
    <changeSet id="7" author="Igor Marchenko">
        <sql>
            insert into dspaceobject (select uuid from faculty)
        </sql>
        <sql>
            insert into dspaceobject (select uuid from chair)
        </sql>
        <sql>
            insert into dspaceobject (select uuid from speciality)
        </sql>
    </changeSet>

    <changeSet author="Igor Marchenko" id="8">
        <addColumn tableName="statistics">
            <column name="uuid" type="UUID"/>
        </addColumn>
    </changeSet>

    <changeSet author="Igor Marchenko" id="9">
        <sql>
            UPDATE statistics st SET uuid = (SELECT uuid FROM item it WHERE it.item_id = st.item_id);
        </sql>
    </changeSet>

    <changeSet author="Igor Marchenko" id="10">
        <dropColumn columnName="item_id" tableName="statistics"/>
    </changeSet>

    <changeSet author="Igor Marchenko" id="11">
        <addPrimaryKey columnNames="uuid, sequence_id, country_code"
                       constraintName="pk_statistics_uuid"
                       tableName="statistics"/>
    </changeSet>

    <changeSet author="Igor Marchenko" id="12">
        <sql>
            DELETE FROM statistics WHERE uuid IS NULL;
        </sql>
    </changeSet>
</databaseChangeLog>