DSpace-CRIS Installation Overview 

- Prerequisite software (see also https://wiki.duraspace.org/display/DSDOC18/Installation#Installation-PrerequisiteSoftware)
-- git (distributed version control system) - download the git console client for your operative system from http://git-scm.com/
-- Apache Maven 2.2.x or 3.0.x or later (Java build tool) -- suggest the 3.0.4 -- download Maven from http://maven.apache.org/
-- Apache Ant(TM) version 1.7.x or later (Java build tool) -- suggest the 1.8.4 -- download Ant from http://ant.apache.org/
-- Relational database PostgreSQL version 9.0 -- suggest the 9.0.3 -- download pgsql from http://www.postgresql.org/
-- Servlet engine Apache Tomcat version 6 -- suggest the 6.0.35 -- download tomcat from http://tomcat.apache.org/

0) Create the DSpace user. This needs to be the same user that Tomcat will run as. e.g. as root run:
	 
	 useradd -m dspace
	
1) get sources from github repository -- CILEA organization -- https://github.com/CILEA

usercris@servercris /e
$ mkdir crisinstallation

usercris@servercris /e
$ cd crisinstallation/

usercris@servercris /e/crisinstallation
$ git clone https://github.com/CILEA/DSpace.git --branch dspace-1_8_x-cris dspace-parent/
Cloning into 'dspace-parent'...
remote: Counting objects: 72473, done.
remote: Compressing objects: 100% (20138/20138), done.
remote: Total 72473 (delta 39654), reused 71901 (delta 39325) 
Receiving objects: 100% (72473/72473), 72.70 MiB | 2.19 MiB/s, done.

Resolving deltas: 100% (39654/39654), done.

usercris@servercris /e/crisinstallation
$ cd dspace-parent/

usercris@servercris /e/crisinstallation/dspace-parent (dspace-1_8_x-cris)
$ git submodule sync

usercris@servercris /e/crisinstallation/dspace-parent (dspace-1_8_x-cris)
$ git submodule update --init dspace-cris/
Submodule 'dspace-cris' (https://github.com/CILEA/dspace-cris.git) registered for path 'dspace-cris'
Cloning into 'dspace-cris'...
remote: Counting objects: 4443, done.
remote: Compressing objects: 100% (1660/1660), done.
remote: Total 4443 (delta 2561), reused 3785 (delta 1903)
Receiving objects: 100% (4443/4443), 1.38 MiB | 622 KiB/s, done.
Resolving deltas: 100% (2561/2561), done.
Submodule path 'dspace-cris': checked out '1fafb49c393d99adf1f14220229db0dea6eebd79'

usercris@servercris /e/crisinstallation/dspace-parent (dspace-1_8_x-cris)
$ cd ..

usercris@servercris /e/crisinstallation
$ git clone https://github.com/CILEA/CCommons.git --branch master ccommons/
Cloning into 'ccommons'...
remote: Counting objects: 304, done.
remote: Compressing objects: 100% (148/148), done.
Remote: Total 304 (delta 101), reused 289 (delta 86)

Receiving objects: 100% (304/304), 57.86 KiB, done.
Resolving deltas: 100% (101/101), done.

usercris@servercris /e/crisinstallation
$ git clone https://github.com/CILEA/JDynA.git --branch master jdyna/
Cloning into 'jdyna'...
remote: Counting objects: 4870, done.
remote: Compressing objects: 100% (1890/1890), done.
remote: Total 4870 (delta 2069), reused 4566 (delta 1765)
Receiving objects: 100% (4870/4870), 1.16 MiB | 355 KiB/s, done.
Resolving deltas: 100% (2069/2069), done.

2) Database Setup 

    PostgreSQL:

    A PostgreSQL JDBC driver is configured as part of the default DSpace build. You no longer need to copy any PostgreSQL jars to get PostgreSQL installed.
    Create a dspace database user. This is entirely separate from the dspace operating-system user created above.
    createuser -U postgres -d -A -P dspace
    You will be prompted for the password of the PostgreSQL superuser (postgres). Then you'll be prompted (twice) for a password for the new dspace user.
    Create a dspace database, owned by the dspace PostgreSQL user (you are still logged in at 'root'):
    createdb -U dspace -E UNICODE dspace
    You will be prompted for the password of the DSpace database user. (This isn't the same as the dspace user's UNIX password.)




3) Initial Configuration: 
		
		Edit [dspace-source]/dspace/config/dspace.cfg, in particular you'll need to set these properties:

    dspace.dir - must be set to the [dspace] (installation) directory.
    dspace.url - complete URL of this server's DSpace home page.
    dspace.hostname - fully-qualified domain name of web server.
    dspace.name - "Proper" name of your server, e.g. "My Digital Library".
    db.password - the database password you entered in the previous step.
    mail.server - fully-qualified domain name of your outgoing mail server.
    mail.from.address - the "From:" address to put on email sent by DSpace.
    feedback.recipient - mailbox for feedback mail.
    mail.admin - mailbox for DSpace site administrator.
    alert.recipient - mailbox for server errors/alerts (not essential but very useful!)
    registration.notify - mailbox for emails when new users register (optional) 

3.1) Edit [dspace-source]/dspace-cris/api/src/main/resources/hibernate/hibernate-rp.properties 
		
	hibernate.connection.url=<INSERTHERETHEPROPERTYVALUE-db.url-SEEDSPACECONFIGURATIONFILE>
    hibernate.connection.username=<INSERTHERETHEPROPERTYVALUE-db.username-SEEDSPACECONFIGURATIONFILE>
    hibernate.connection.password=<INSERTHERETHEPROPERTYVALUE-db.password-SEEDSPACECONFIGURATIONFILE>

e.g.
		hibernate.connection.url=jdbc:postgresql://localhost:5432/dspace
		hibernate.connection.username=dspace
		hibernate.connection.password=dspace

4) DSpace Directory: 

Create the directory for the DSpace installation (i.e. [dspace]). As root (or a user with appropriate permissions), run:

mkdir [dspace]
chown dspace [dspace]


5) Pre-Installation: install artifacts in maven local repository

5.1) prerequisite install dwr artifact download in /e/crisinstallation from https://java.net/downloads/dwr/Version%202.0.6/dwr.jar

usercris@servercris /e/crisinstallation
$ mvn install:install-file -Dfile=dwr.jar -DgroupId=org.directwebremoting -DartifactId=dwr -Dversion=2.0.6 -Dpackaging=jar
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Maven Stub Project (No POM) 1
....
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1.680s
[INFO] Finished at: Wed Nov 21 10:47:16 CET 2012
[INFO] Final Memory: 2M/90M
[INFO] ------------------------------------------------------------------------

5.2) install in local maven repository CCommons and JDynA artifacts

usercris@servercris /e/crisinstallation
$ cd ccommons/

usercris@servercris /e/crisinstallation/ccommons
$ mvn install

...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------


usercris@servercris /e/crisinstallation
$ cd ..

usercris@servercris /e/crisinstallation
$ cd jdyna/

usercris@servercris /e/crisinstallation/jdyna
$ mvn install

...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------


6) Installation Package: 

usercris@servercris /e/crisinstallation
$ cd dspace-parent/

usercris@servercris /e/crisinstallation/dspace-parent
$ mvn package

[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO]
[INFO] DSpace Parent Project ............................. SUCCESS [0.874s]
[INFO] ResearcherPage .................................... SUCCESS [0.031s]
[INFO] Reseacher Page :: Web Application Resources ....... SUCCESS [2.465s]
[INFO] DSpace Kernel :: API and Implementation ........... SUCCESS [3.260s]
[INFO] DSpace Solr Statistics Logging Client Library ..... SUCCESS [1.295s]
[INFO] DSpace JSP-UI ..................................... SUCCESS [0.016s]
[INFO] DSpace JSP-UI :: API and Implementation ........... SUCCESS [0.530s]
[INFO] DSpace JSP-UI :: Web Application Resources ........ SUCCESS [2.434s]
[INFO] Researcher Page :: API ............................ SUCCESS [4.945s]
[INFO] Researcher Page :: JSPUI API ...................... SUCCESS [1.279s]
[INFO] DSpace Addon Modules .............................. SUCCESS [0.000s]
[INFO] DSpace JSP-UI :: Web Application .................. SUCCESS [20.670s]
[INFO] DSpace SOLR :: Web Application .................... SUCCESS [15.382s]
[INFO] DSpace Assembly and Configuration ................. SUCCESS [47.783s]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1:42.087s
[INFO] Finished at: Wed Nov 21 11:56:03 CET 2012
[INFO] Final Memory: 41M/546M
[INFO] ------------------------------------------------------------------------


8) Build DSpace and Initialize Database: As the dspace UNIX user, initialize the DSpace database and install DSpace to [dspace]_:

cd [dspace-source]/dspace/target/dspace-[version]-build
ant fresh_install

-----------------------
BUILD SUCCESSFUL
Total time: 49 seconds
-----------------------
8.1) Create CRIS folders:

usercris@servercris [dspace-source]/dspace/target/dspace-[version]-build
$ cd [dspace]

usercris@servercris [dspace]
$ mkdir rp-files
$ mkdir rg-files
$ mkdir ou-files

9) Update database to CRIS: run sql update
[dspace]/etc/postgres/addon-crismodule.sql

10) Deploy Web Applications: You have two choices or techniques for having Tomcat serve up your web applications:

    Technique A. Simple and complete. You copy only (or all) of the DSpace Web application(s) you wish to use from the [dspace]/webapps directory to the appropriate directory in your Tomcat installation. For example:
    cp -R [dspace]/webapps/* [tomcat]/webapps* (This will copy all the web applications to Tomcat).
    
    Technique B. Tell your Tomcat installation where to find your DSpace web application(s). As an example, in the <Host> section of your [tomcat]/conf/server.xml you could add lines similar to the following (but replace [dspace] with your installation location):
    <!-- Define the default virtual host
        Note:  XML Schema validation will not work with Xerces 2.2.
        -->
        <Host name="localhost"  appBase="[dspace]/webapps"
        ....
        
11) copy lib
$ cp -R  [tomcat]/webapps/jspui/WEB-INF/lib/* [dspace]/lib/

12) Administrator Account: Create an initial administrator account:
[dspace]/bin/dspace create-administrator

-----------------------------
Administrator account created
-----------------------------


13) Initial Startup! Now the moment of truth! Start up (or restart) Tomcat. Visit the base URL(s) of your server.  
		Base URL of DSpace Web Applications:
        JSP User Interface - (e.g.) http://localhost:8080/jspui        

You should see the DSpace home page. Congratulations! DSpace is live! And your journey to the world of DSpace-CRIS is just started! 

Now Dspace-CRIS data configuration is empty, you can populate database with the default configuration running the base-configuration-crismodule.sql:

[dspace]/etc/postgres/base-configuration-crismodule.sql

This sql file create for you a base metadata configuration for Researcher profile, Organization Unit and Project entity.
You can build or add a custom metadata dynamically enjoying the administration section CRIS module. 

Login with your administrator account and go to "Administer->CRIS Module". Here there is the "Research Information System Administration" section. 
Here you can create Researcher Profile, Projects, Organization Unit, create layout artifact like Tabs, Box and configure the metadata definitions for all entities (e.g. assing a "Personal site page" metadata to the entity Researcher Profile).