<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<HTML>
  <HEAD>
    <TITLE>DSpace System Documentation: Configuration and Customization</TITLE>
    <LINK REL=StyleSheet HREF="style.css" TYPE="text/css">
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" >
  </HEAD>
  <BODY>
    <H1>DSpace System Documentation: Configuration and Customization</H1>

    <P><A HREF="index.html">Back to contents</A></P>

    <P>There are a number of ways in which DSpace can be configured and/or customized:</P>

    <UL>
      <LI>Altering the configuration files in <code><i>[dspace]</i>/config</code></LI>
      <LI>Creating modified versions of the JSPs; these can be placed separately from and override the default installed JSPs, so that future updates of the code won't overwrite your changes</LI>
      <LI>Implementing a custom 'authenticator' class, so that user authentication in the Web UI can be adapted and integrated with any existing mechanisms your organization might use</LI>
      <LI>Editing the source code</LI>
    </UL>

    <P>Of these methods, only the last is likely to cause any headaches; if you update the DSpace source code directly, it may make applying future updates difficult.  However, DSpace is open source, of course, and if you make any modifications that might be helpful to other institutions or organizations, feel free to send them to the DSpace team at MIT.</P>


    <H2><A NAME="dspacecfg">The <code>dspace.cfg</code> Configuration Properties File</A></H2>

    <P>The primary way of configuring DSpace is to edit the <code>dspace.cfg</code>.  You'll definitely have to do this before you can operate DSpace properly.  <code>dspace.cfg</code> contains basic information about a DSpace installation, including system path information, network host information, and other things like site name.</P>

    <P>The default <code>dspace.cfg</code> is a good source of information, and contains comments for all properties.  It's a basic Java properties file, where lines are either comments, starting with a '<code>#</code>', blank lines, or property/value pairs of the form:</P>

    <PRE>property.name = property value</PRE>

    <P>Due to time constraints, this document does not contain an exhaustive list of properties; they are all listed in the supplied <code>dspace.cfg</code>.  Below are some particularly relevant properties with notes for their use:</P>

    <TABLE>
      <CAPTION><code>dspace.cfg</code> Main Properties (Not Complete)</CAPTION>
      <TR>
        <TH>Property</TH>
        <TH>Example Values</TH>
        <TH>Notes</TH>
      </TR>
      <TR>
        <TD><code>dspace.dir</code></TD>
        <TD><code>/dspace</code></TD>
        <TD>Root directory of DSpace installation.  Omit the trailing '/'.  Note that if you change this, there are several other parameters you will probably want to change to match, e.g. <code>assetstore.dir</code>.</TD>
      </TR>
      <TR>
        <TD><code>dspace.url</code></TD>
        <TD><code>http://dspace.myu.edu</code><br><code>http://dspacetest.myu.edu:8080</code></TD>
        <TD>Main URL at which DSpace Web UI webapp is deployed.  Include any port number, but do not include a trailing '/'</TD>
      </TR>
      <TR>
        <TD><code>dspace.hostname</code></TD>
        <TD><code>dspace.myu.edu</code></TD>
        <TD>Fully qualified hostname; do not include port number</TD>
      </TR>
      <TR>
        <TD><code>dspace.name</code></TD>
        <TD><code>DSpace at My University</code></TD>
        <TD>Short and sweet site name, used throughout Web UI, e-mails and elsewhere (such as OAI protocol)</TD>
      </TR>
      <TR>
        <TD><code>config.template.foo</code></TD>
        <TD><code>/opt/othertool/cfg/foo</code></TD>
        <TD>When <code>install-configs</code> is run, the file <code><i>[dspace]</i>/config/templates/foo</code> file will be filled out with values from <code>dspace.cfg</code> and copied to the value of this property, in this example <code>/opt/othertool/cfg/foo</code>.  <A HREF="#templates">See here for more information.</A></TD>
      </TR>
      <TR>
        <TD><code>webui.site.authenticator</code></TD>
        <TD><code>edu.myu.MyAuthenticator</code></TD>
        <TD>The Java class name of a class implementing the <code>org.dspace.app.webui.SiteAuthenticator</code> interface.</TD>
      </TR>
      <TR>
        <TD><code>handle.prefix</code></TD>
        <TD><code>1721.1234</code></TD>
        <TD>The Handle prefix for your site, <A HREF="install.html#handles">see the Handle section</A></TD>
      </TR>
      <TR>
        <TD><code>assetstore.dir</code></TD>
        <TD><code>/bigdisk/store</code></TD>
        <TD>The location in the file system for asset (bitstream) store number zero.  This should be a directory for the sole use of DSpace.</TD>
      </TR>
      <TR>
        <TD><code>assetstore.dir.n</code></TD>
        <TD><code>/anotherdisk/store1</code></TD>
        <TD>The location in the file system of asset (bitstream) store number <code>n</code>.  When adding additional stores, start with 1 (<code>assetstore.dir.1</code> and count upwards.  Always leave asset store zero (<code>assetstore.dir</code>).  For more details, see <A HREF="storage.html#bitstreams">the Bitstream Storage section</A>.</TD>
      </TR>
      <TR>
        <TD><code>assetstore.incoming</code></TD>
        <TD><code>1</code></TD>
        <TD>The asset store number to use for storing new bitstreams.  For example, if <code>assetstore.dir.1</code> is <code>/anotherdisk/store1</code>, and <code>assetstore.incoming</code> is <code>1</code>, new bitstreams will be stored under <code>/anotherdisk/store1</code>.  A value of <code>0</code> (zero) corresponds to <code>assetstore.dir</code>.  For more details, see <A HREF="storage.html#bitstreams">the Bitstream Storage section</A>.</TD>
      </TR>
      <TR>
        <TD><code>webui.submit.enable-cc</code></TD>
        <TD><code>true</code></TD>
        <TD>Enable the Creative Commons license step in the submission process. Submitters are given an opportunity to select a Creative Commons license to accompany the Item. Creative Commons licenses govern the use of the content. For more details, see <A HREF="http://creativecommons.org">the Creative Commons website</A>.</TD>
      </TR>
    </TABLE>

    <P>Whenever you edit <code>dspace.cfg</code>, you should then run <code><i>[dspace]</i>/bin/install-configs</code> so that any changes you may have made are reflected in the configuration files of other applications, for example Apache.  You may then need to restart those applications, depending on what you changed.</P>


    <H2><A NAME="email">Wording of E-mail Messages</A></H2>

    <P>Sometimes DSpace automatically sends e-mail messages to users, for example to inform them of a new workflow task, or as a subscription e-mail alert.  The wording of emails can be changed by editing the relevant file in <code><i>[dspace]</i>/config/emails</code>.  Each file is commented.  Be careful to keep the right number 'placeholders' (e.g.<code>{2}</code>).</P>


    <H2><A NAME="email">Local DSpace Administrator Contact Information</A></H2>

    <P>There are several places in DSpace in which the user will be shown contact information
    for the local DSpace Administrator: for instance, when an error occurs, or in the on-line help
    when the user is looking for more information. The contact information is displayed by <code><i>[dspace-source]</i>/jsp/components/contact-info.jsp.</code>
    This JSP retrieves the help e-mail in dspace.cfg, but the phone number in the JSP is a dummy phone
    number that needs to be edited directly in the JSP. You should be sure to edit this file (adding any additional information
    you feel might be useful) so that users know who to contact for further information.</P>


    <H2><A NAME="registries">The Dublin Core and Bitstream Format Registries</A></H2>

    <P>The <code><i>[dspace]</i>/config/registries</code> directory contains two XML files.  These are used to load the <em>initial</em> contents of the Dublin Core type registry and Bitstream Format registry.  After the initial loading (performed by <code>ant fresh_install</code> above), the registries reside in the database; the XML files are not updated.</P>

    <P>Currently, the system requires that every item have a Dublin Core record.  The exact Dublin Core elements and qualifiers that are used can be configured by editing the Dublin Core registry.  This can either be done at install-time, by editing <code><i>[dspace]</i>/config/registries/dublin-core-types.xml</code>, or at run-time using the administration Web UI.  However, note that some elements and qualifiers must be present for DSpace to function correctly since they are used for various purposes by the code.  Details are in the relevant <code>.xml</code> file.</p>

    <P>Also note that altering the Dublin Core registry does not, at the current time, cause corresponding changes in the Web UI (e.g. the submission interface or search indices).</P>

    <P>The bitstream formats recognized by the system and levels of support are similarly stored in the bitstream format registry.  This can also be edited at install-time via <code><i>[dspace]</i>/config/registries/bitstream-formats.xml</code> or by the administation Web UI.  The contents of the bitstream format registry are entirely up to you, though the system requires that the following two formats are present:</p>

    <UL>
      <LI><CODE>Unknown</CODE></LI>
      <LI><CODE>License</CODE></LI>
    </UL>


    <H2><A NAME="templates">Configuration Files for Other Applications</A></H2>

    <P>To ease the hassle of keeping configuration files for other applications involved in running a DSpace site, for example Apache, in sync, the DSpace system can automatically update them for you when the main DSpace configuration is changed.  This feature of the DSpace system is entirely optional, but we found it useful.</P>

    <P>The way this is done is by placing the configuration files for those applications in <code><i>[dspace]</i>/config/templates</code>, and inserting special values in the configuration file that will be filled out with appropriate DSpace configuration properties.  Then, tell DSpace where to put filled-out, 'live' version of the configuration by adding an appropriate property to <code>dspace.cfg</code>, and run <code><i>[dspace]</i>/bin/install-configs</code>.</P>

    <P>Take the <code>apache13.conf</code> file as an example.  This contains plenty of Apache-specific stuff, but where it uses a value that should be kept in sync across DSpace and associated applications, a 'placeholder' value is written.  For example, the host name:</P>

    <PRE>ServerName @@dspace.hostname@@</PRE>

    <P>The text <code>@@dspace.hostname@@</code> will be filled out with the value of the <code>dspace.hostname</code> property in <code>dspace.cfg</code>.  Then we decide where we want the 'live' version, that is, the version actually read in by Apache when it starts up, will go.</P>

    <P>Let's say we want the live version to be located at <code>/opt/apache/conf/dspace-httpd.conf</code>.  To do this, we add the following property to <code>dspace.cfg</code> so DSpace knows where to put it:</P>

    <PRE>config.template.apache13.conf = /opt/apache/conf/dspace-httpd.conf</PRE>

    <P>Now, we run <code><i>[dspace]</i>/bin/install-configs</code>.  This reads in <code><i>[dspace]</i>/config/templates/apache13.conf</code>, and places a copy at <code>/opt/apache/conf/dspace-httpd.conf</code> with the placeholders filled out.</P>

    <P>So, in <code>/opt/apache/conf/dspace-httpd.conf</code>, there will be a line like:</P>

    <pre>ServerName dspace.myu.edu</pre>

    <P>The advantage of this approach is that if a property like the hostname changes, you can just change it in <code>dspace.cfg</code> and run <code>install-configs</code>, and all of your tools' configuration files will be updated.</P>

    <P>However, take care to make all your edits to the versions in <code><i>[dspace]</i>/config/templates</code>!  It's a wise idea to put a big reminder at the top of each file, since someone might unwittingly edit a 'live' configuration file which would later be overwritten.</P>



    <H2><A NAME="customui">Customizing the Web User Interface</A></H2>

    <P>The Web UI is implemented using Java Servlets which handle the business logic, and JavaServer Pages (JSPs) which produce the HTML pages sent to an end-user.  Since the JSPs are much closer to HTML than Java code, altering the look and feel of DSpace is relatively easy.</P>

    <P>To make it even easier, DSpace allows you to 'override' the JSPs included in the source distribution with modified versions, that are stored in a separate place, so when it comes to updating your site with a new DSpace release, your modified versions will not be overwritten.</P>

    <P>However, note that the data (attributes) passed from an underlying Servlet to the JSP may change between versions, so you may have to modify your customized Servlet to deal with the new data.</P>

    <P>The JSPs are stored in <code><i>[dspace-source]</i>/jsp</code>.  Place your edited version of a JSP in the <code><i>[dspace-source]</i>/jsp/local</code> directory, with the same path as the original.  If they exist, these will be used in preference to the distributed versions in <code><i>[dspace-source]</i>/jsp</code>.  For example:</P>

    <table>
      <tr>
        <th>DSpace default</th>
        <th>Locally-modified version</th>
      </tr>
      <tr>
        <td><code><i>[dspace-source]</i>/jsp/community-list.jsp</code></td>
        <td><code><i>[dspace-source]</i>/jsp/local/community-list.jsp</code></td>
      </tr>
      <tr>
        <td><code><i>[dspace-source]</i>/jsp/mydspace/main.jsp</code></td>
        <td><code><i>[dspace-source]</i>/jsp/local/mydspace/main.jsp</code></td>
      </tr>
     </table>

    <P>Heavy use is made of a style sheet, in <code><i>[dspace-source]</i>/jsp/styles.css.jsp</code>.  If you make edits, call the local version <code><i>[dspace-source]</i>/jsp/local/styles.css.jsp</code>, and it will be used automatically in preference to the default, as described above.</P>

    <P>Fonts and colors can be easily changed using the stylesheet.  The stylesheet is a JSP so that the user's browser version can be detected and the stylesheet tweaked accordingly.</P>

    <P>The 'layout' of each page, that is, the top and bottom banners and the navigation bar, are determined by the JSPs <code><i>[dspace-source]</i>/jsp/layout/header-*.jsp</code> and <code><i>[dspace-source]</i>/jsp/layout/footer-*.jsp</code>.  You can provide modified versions of these (in <code><i>[dspace-source]</i>/jsp/local/layout</code>, or define more styles and apply them to pages by using the "style" attribute of the <code>dspace:layout</code> tag.</P>

    <p>After you've customized your JSPs, <strong>you must rebuild the DSpace Web application</strong>. If you haven't already built and installed it, follow the <a href="install.html">install</a> directions. Otherwise, follow the steps below:</p>

    <ol>
      <li><P>Rebuild the <code>dspace.war</code> file by running the following command from your <code><i>[dspace-source]</i></code> directory:</p>

      <pre>ant -Dconfig=<i>[dspace]</i>/config/dspace.cfg build_wars</pre></li>

      <li><p>Shut down Tomcat, and delete the existing <i>[tomcat]</i>/webapps/dspace directory.</p></li>

      <li><p>Copy the new .war file to the Tomcat webapps directory:</p>

      <pre>cp <i>[dspace-source]</i>/build/dspace.war <i>[tomcat]</i>/webapps</pre></li>
    </ol>

    <p>When you restart the web server you should see your customized JSPs.</p>

    <H2><A NAME="authenticate">Custom Authentication Code</A></H2>

    <P>Since many institutions and organizations have exisiting authentication systems, DSpace has been designed to allow these to be easily integrated.  To do this, you can provide a custom class implementing the Java interface <code>org.dspace.app.webui.SiteAuthenticator</code>.  These methods are invoked when various authentication-related events occur in the Web user interface.</P>

    <P>The basic authentication procedure in the DSpace Web UI is this:</P>

    <OL>
      <LI>A request is received from an end-user's browser that, if fulfilled, would lead to an action requiring authorization taking place.</LI>
      <LI>If the end-user is already authenticated:
        <UL>
          <LI>If the end-user is allowed to perform the action, the action proceeds</LI>
          <LI>If the end-user is NOT allowed to perform the action, an authorization error is displayed.</LI>
        </UL>
      </LI>
      <LI>If the end-user is NOT authenticated, i.e. is accessing DSpace anonymously:
        <UL>
          <LI>The parameters etc. of the request are stored</LI>
          <LI>The <code>startAuthentication</code> method is invoked on the currently configured <code>SiteAuthenticator</code> implementation</LI>
          <LI>That <code>startAuthentication</code> might instantly authenticate the user somehow, or forward the request to some sort of log-in page--the parameters of the original request are safely stored and will be accessible after the log-in process has completed</LI>
          <LI>If authentication is successful, the original request is resumed from step 2. above.</LI>
        </UL>
      </LI>
    </OL>

    <P>Please see the <code>SiteAuthenticator.java</code> source file for information about each of the methods.  The default implementation, <code>org.dspace.app.webui.SimpleAuthenticator</code>, is a simple implementation that implements these policies:</P>

    <UL>
      <LI><P>Use of inbuilt e-mail address/password-based log-in.  This is achieved by forwarding a request that is attempting an action requiring authorization to the password log-in servlet, <code>/password-login</code>.  The password log-in servlet (<code>org.dspace.app.webui.servlet.PasswordServlet</code> contains code that will resume the original request if authentication is successful, as per step 3. described above.</P></LI>
      <LI><P>Users can register themselves (i.e. add themselves as e-people without needing approval from the administrators), and can set their own passwords when they do this</P></LI>
      <LI><P>Users are not members of any special (dynamic) e-person groups</P></LI>
    </UL>

    <P>Included in the source is the implementation of <code>SiteAuthenticator</code> used at MIT, <code>edu.mit.dspace.MITAuthenticator</code>.  This implements a slightly more complex authentication mechanism:</P>

    <UL>
      <LI><P>If an authentication user in an MIT user, they must log in using an X509 Web certificate.  The <code>certificate-login</code> servlet, similar to the <code>password-login</code> servlet, authenticates users via these certificates, and if successful, resumes the original request just as the password log-in servlet would.</P></LI>

      <LI><P>MIT users are also automatically added to the special (dynamic) group called 'MIT Users' (which must be present in the system!).  This allows us to create authorization policies for MIT users without having to manually maintain membership of the MIT users group.</P></LI>

      <LI><P>Anyone can register themselves, but MIT users doing this cannot set a password; they must use their X509 Web certificate to log in.</P></LI>
    </UL>

    <P>The X509 certificate login servlet has an extra feature:  If the <code>webui.cert.autoregister</code> configuration property is <code>true</code>, it will automatically register the user with the system.</P>

    <P>You could create a customized version of the password login servlet to perform a similar action.  For example, if your organization uses Windows NT domain authentication, you could implement a version of PasswordServlet.java that validates against Windows NT authentication, and automatically adds an e-person record for new users.  It is strongly recommended that you do not edit PasswordServlet but create a new servlet for this, so that future updates of the DSpace code do not overwrite your changes.  You would also have to implement a customized <code>SiteAuthenticator</code> in which the <code>startAuthentication</code> method would forward requests to your new servlet.</P>

    <h2><a name="webuithumbs">Displaying Image Thumbnails</a></h2>

    <h3>Browse and Search Results Page Thumbnails</h3>
    <p>Image thumbnails can be enabled on the Browse and Search Results pages by setting the appropriate configuration values. To enable the display of thumbnails the following items must be set in the <code>dspace.cfg</code> file:</p>

    <p><code>webui.browse.thumbnail.show = true</code></p>

    <p>If set to <code>false</code> or this configuration item is missing then thumbnails will not be shown.</p>

    <p>The size of the browse/search thumbnails can also be configured to a smaller size than that generated by the mediafilter. To do this set the following configuration items:</p>

    <p><code>webui.browse.thumbnail.maxheight = &lt;maxheight in pixels&gt;</code></p>

    <p><code>webui.browse.thumbnail.maxwidth = &lt;maxwidth in pixels&gt;</code></p>

    <p>If these configuration items are not set, <code>thumbnail.maxheight</code> and <code>thumbnail.maxwidth</code> are used. Setting these values greater than or equal to the size of the thumbnail generated by the mediafilter (i.e. <code>thumbnail.maxheight</code> and <code>thumbnail.maxwidth</code>) will have no effect.</p>

    <p><strong>Note:</strong></P>
    <ul>
    <li>where the primary bitstream is HTML, no thumbnail is shown;</li>
    <li>where the primary bitstream has a thumbnail, its thumbnail is shown;</li>
    <li>where the primary bitstream is not set, the first thumbnail found by DSpace will be shown;</li>
    <li>where the user does not have read access to the thumbnail bitstream, no thumbnail is shown;</li>
    <li>currently, for a thumbnail to display, a JPEG thumbnail under the current implementation rules must exist (i.e. primary bitstream name with ".jpg" suffix).</li>
    </ul>

    <H3>Configuring Thumbnail Link Behaviour</h3>
    <p>The target of a thumbnail in the Browse and Search Results Page can be configured by setting the following configuration item:</p>
    <p><code>webui.browse.thumbnail.linkbehaviour = &lt;target page type&gt;</code></p>
    <p>Currently the values <code>item</code> and <code>bitstream</code> are allowed. If this configuration item is not set, or set incorrectly, the default is <code>item</code>.</p>

    <H3>Item Display Page Thumbnails</H3>
    <p>Thumbnails may also be enabled or disabled on the Item Display page by setting the following configuration item in <code>dspace.cfg</code>:</p>

    <p><code>webui.item.thumbnail.show = true</code></p>

    <p>If set to <code>false</code> or this configuration item is missing then thumbnails will not be shown.</p>

    <h2><a name="strengths">Displaying Community and Collection Item Counts</a></h2>
	<p>To show the item count against communities and collections set the <code>webui.strengths.show</code> configuration item in the <code>dspace.cfg</code> file as follows:</p>    
    <p><code>webui.strengths.show = true</code></p>
	<p>If this config item is missing or is set to any value other than <code>true</code> the item counts will not be shown</p>
	
    <H2><A NAME="help">On-line Help About File Formats</A></H2>

    <p>Because the file format support policy is determined by each individual institution, the on-line help on this subject is intentionally left blank. The help file will, however, retrieve a list of formats and the support levels associated with them in your database and display this information to the user. We highly recommend that you edit the "Format Support Policy" section of the file <code><i>[dspace-source]</i>/jsp/help/formats.jsp</code>.</p>

    <HR>

    <ADDRESS>
     Copyright &copy; 2002-2004 MIT and Hewlett Packard
    </ADDRESS>
  </BODY>
</HTML>
