# Edit this file to introduce tasks to be run by cron.
# 
# Each task to run has to be defined through a single line
# indicating with different fields when the task will be run
# and what command to run for the task
# 
# To define the time you can provide concrete values for
# minute (m), hour (h), day of month (dom), month (mon),
# and day of week (dow) or use '*' in these fields (for 'any').# 
# Notice that tasks will be started based on the cron's system
# daemon's notion of time and timezones.
# 
# Output of the crontab jobs (including errors) is sent through
# email to the user the crontab file belongs to (unless redirected).
# 
# For example, you can run a backup of all your user accounts
# at 5 a.m every week with:
# 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/
# 
# For more information see the manual pages of crontab(5) and cron(8)
# 
# m h  dom mon dow   command

#VER https://www.google.com/calendar/b/1/embed?src=sedici.unlp.edu.ar_0ri54lra5dpgau9cth4aff37tk@group.calendar.google.com

JAVA_OPTS=-Xmx1024M

# ########## MAILS ######################
# Send out subscription e-mails at 01:00 every day
0 1 * * *  /var/dspace/bin/dspace sub-daily
# Run the media filter at 02:00 every day
#0 2 * * *  /var/dspace/bin/dspace filter-media
1 23 * * *  /var/dspace/bin/dspace filter-media -s 10915/5621,10915/2618,10915/2762,10915/15912,10915/2272,10915/15920,10915/5226 | grep -v SKIPPED | grep -v FILTERED
# Run the checksum checker at 03:00
0 3 * * *  /var/dspace/bin/dspace checker -lp | grep -v " old results from the database"

# Mail the results to the sysadmin at 04:00
2 4 * * 1  /var/dspace/bin/dspace checker-emailer -c

#actualizo el indice de xoai 4veces al dia
1 9,12,15,19 * * *  /var/dspace/bin/dspace xoai import > /dev/null

#Actualizo el indice discovery a las 23hs todos lso dias para optimizarlo y quitarle todos los docs que ya no existen
0 20 * * *  /var/dspace/bin/dspace update-discovery-index -co > /dev/null

#Reconstruye el indice discovery el dia 2 de cada mes a las 22hs y lo optimiza
#0 22 2 * *  /var/dspace/bin/dspace update-discovery-index -bo > /dev/null

#Reconstruye el indice xoai el dia 3 de cada mes a las 22 hs y lo optimiza
#0 22 3 * *  /var/dspace/bin/dspace xoai import -cvo > /dev/null

#actualizo la lista de spiders ips
10 6 3 * * /var/dspace/bin/dspace stats-util -u 
15 4 * * * /var/dspace/bin/dspace stats-util -m

#Generate Sitemaps
0 6 * * *  /var/dspace/bin/dspace generate-sitemaps 

#Check for pendign embargoes
1 6 * * *  /var/dspace/bin/dspace embargo-lifter 

#Actualizacion de la bbdd geolite. ver mas en http://trac.prebi.unlp.edu.ar/issues/1702
0 5 2 * *  ant -f /var/dspace-src/distribution/target/dspace-sedici-distribution-bin/build.xml update_geolite

#Backup en AIP una vez por semana
5 22 * * sun  date && /var/dspace/bin/dspace packager -d -a -t AIP -e alira@sedici.unlp.edu.ar -u -i 10915/0 /var/dspace/backups/aip/aip-site.zip && date

#GZip de logs viejos los lunes a las 5AM
0 5 * * mon find /var/log/tomcat6 -maxdepth 1 -name "catalina.*" -type f -mtime +5 -exec -q gzip {} \; -exec mv {}.gz /var/log/tomcat6/old-logs/ \;
2 5 * * mon find /var/log/tomcat6 -maxdepth 1 -name "localhost.*" -type f -mtime +5 -exec -q gzip {} \; -exec mv {}.gz /var/log/tomcat6/old-logs/ \;
5 5 * * mon find /var/dspace/log -maxdepth 1 -name "dspace.log.*" -type f -mtime +30 -exec -q gzip {} \; -exec mv {}.gz /var/dspace/log/old-logs/ \;

# ########## STATS ######################
0 1 * * * /var/dspace/bin/dspace stat-general
0 1 * * * /var/dspace/bin/dspace stat-monthly
# Los reportes son innecesarios para XMLUI
#0 2 * * * /var/dspace/bin/dspace stat-report-general
#0 2 * * * /var/dspace/bin/dspace stat-report-monthly

# ########## POSTGRES ######################
# Clean up the database nightly at 4.20am
# 20 4 * * * vacuumdb --analyze dspace > /dev/null 2>&1
