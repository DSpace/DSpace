<?xml version='1.0' encoding='UTF-8'?>
<chapter remap="h1">
    <title><anchor id="docbook-directories.html"/>DSpace System Documentation: Directories and Files</title>
    <section remap="h2">
      <title><anchor id="docbook-directories.html-overview" xreflabel="Overview"/>Overview</title>
      <para>A complete DSpace installation consists of three separate directory trees:</para>
      <variablelist>
        <varlistentry>
          <term>The source directory:</term>
          <listitem>
            <para> This is where (surprise!) the source code lives. Note that the config files here are used only during the initial install process. After the install, config files should be changed in the install directory. It is referred to in this document as <literal>[dspace-source]</literal>.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>The install directory:</term>
          <listitem>
            <para> This directory is populated during the install process and also by DSpace as it runs. It contains config files, command-line tools (and the libraries necessary to run them), and usually--although not necessarily--the contents of the DSpace archive (depending on how DSpace is configured). After the initial build and install, changes to config files should be made in this directory. It is referred to in this document as <literal>[dspace]</literal>.</para>
          </listitem>
        </varlistentry>
        <varlistentry>
          <term>The web deployment directory:</term>
          <listitem>
            <para> This directory is generated by the web server the first time it finds a dspace.war file in its webapps directory. It contains the unpacked contents of dspace.war, i.e. the JSPs and java classes and libraries necessary to run DSpace. Files in this directory should never be edited directly; if you wish to modify your DSpace installation, you should edit files in the source directory and then rebuild. The contents of this directory aren&apos;t listed here since its creation is completely automatic. It is usually referred to in this document as <literal>[tomcat]/webapps/dspace</literal>.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
    <section remap="h2">
      <title><anchor id="docbook-directories.html-sourcedir" xreflabel="Source Directory Layout"/>Source Directory Layout</title>
      <itemizedlist>
        <listitem>
          <para>
            <literal>[dspace-source]</literal>
            <itemizedlist>
              <listitem>
                <para><literal>dspace/</literal>  - Directory which contains all build and configuration information for DSpace </para>
                <itemizedlist>
                  <listitem>
                    <para><literal>CHANGES</literal>  - Detailed list of code changes between versions.</para>
                  </listitem>
                  <listitem>
                    <para><literal>KNOWN_BUGS</literal>  - Known bugs in the current version.</para>
                  </listitem>
                  <listitem>
                    <para><literal>LICENSE</literal>  - DSpace source code license.</para>
                  </listitem>
                  <listitem>
                    <para><literal>README</literal>  - Obligatory basic information file.</para>
                  </listitem>
                  <listitem>
                    <para><literal>bin/</literal>  - Some shell and Perl scripts for running DSpace command-line tasks.</para>
                  </listitem>
                  <listitem>
                    <para><literal>config/</literal>  - Configuration files: </para>
                    <itemizedlist>
                      <listitem>
                        <para><literal>controlled-vocabularies/</literal>  - Fixed, limited vocabularies used in metadata entry</para>
                      </listitem>
                      <listitem>
                        <para><literal>crosswalks/</literal>  - Metadata crosswalks - property files or XSL stylesheets</para>
                      </listitem>
                      <listitem>
                        <para><literal>dspace.cfg</literal>  - The Main DSpace configuration file (You will need to edit this).</para>
                      </listitem>
                      <listitem>
                        <para><literal>dc2mods.cfg</literal>  - Mappings from Dublin Core metadata to <ulink url="http://www.loc.gov/standards/mods/">MODS</ulink> for the METS export.</para>
                      </listitem>
                      <listitem>
                        <para><literal>default.license</literal>  - The default license that users must grant when submitting items.</para>
                      </listitem>
                      <listitem>
                        <para><literal>dstat.cfg</literal> , <literal>dstat.map</literal> - Configuration for statistical reports.</para>
                      </listitem>
                      <listitem>
                        <para><literal>input-forms.xml</literal>  - Submission UI metadata field configuration.</para>
                      </listitem>
                      <listitem>
                        <para><literal>news-side.html</literal>  - Text of the front-page news in the sidebar, only used in JSPUI.</para>
                      </listitem>
                      <listitem>
                        <para><literal>news-top.html</literal>  - Text of the front-page news in the top box, only used in teh JSPUI.</para>
                      </listitem>
                      <listitem>
                        <para><literal>emails/</literal>  - Text and layout templates for emails sent out by the system.</para>
                      </listitem>
                      <listitem>
                        <para><literal>registries/</literal>  - <emphasis role="bold">Initial</emphasis> contents of the bitstream format registry and Dublin Core element/qualifier registry. These are only used on initial system setup, after which they are maintained in the database.</para>
                      </listitem>
                     </itemizedlist>
                  </listitem>
                  <listitem>
                    <para><literal>docs/</literal>  - DSpace system documentation. The technical documentation for functionality, installation, configuration, etc.</para>
                  </listitem>
                  <listitem>
                    <para><literal>etc/</literal>  -
This directory contains administrative files needed for the install process and by developers, mostly database initialization and upgrade scripts. Any <literal>.xml</literal> files in <literal>etc/</literal> are common to all supported database systems.</para>
                    <itemizedlist>
                      <listitem>
                        <para><literal>postgres/</literal>  - Versions of the database schema and updater SQL scripts for PostgreSQL.</para>
                      </listitem>
                      <listitem>
                        <para><literal>oracle/</literal>  - Versions of the database schema and updater SQL scripts for Oracle.</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para><literal>modules/</literal>  - The Web UI modules &quot;overlay&quot; directory. DSpace uses Maven to automatically look here for any customizations you wish to make to DSpace Web interfaces. </para>
                    <itemizedlist>
                      <listitem>
                        <para><literal>jspui</literal>  - Contains all customizations for the JSP User Interface. </para>
                        <itemizedlist>
                          <listitem>
                            <para><literal>src/main/resources/</literal>  - The overlay for JSPUI <emphasis>Resources.</emphasis> This is the location to place any custom Messages.properties files.  <emphasis>(Previously this file had been stored at: <literal>[dspace-source]/config/language-packs/Messages.properties</literal></emphasis></para>
                          </listitem>
                          <listitem>
                            <para><literal>src/main/webapp/</literal>  - The overlay for JSPUI Web Application. This is the location to place any custom JSPs to be used by DSpace.</para>
                          </listitem>
                        </itemizedlist>
                      </listitem>
                      <listitem>
                        <para><literal>lni</literal>  - Contains all customizations for the Lightweight Network Interface.</para>
                      </listitem>
                      <listitem>
                        <para><literal>oai</literal>  - Contains all customizations for the OAI-PMH Interface.</para>
                      </listitem>
                      <listitem>
                        <para><literal>sword</literal>  - Contains all customizations for the SWORD (Simple Web-service Offering Repository Deposit) Interface.</para>
                      </listitem>
                      <listitem>
                        <para><literal>xmlui</literal>  - Contains all customizations for the XML User Interface (aka Manakin). </para>
                        <itemizedlist>
                          <listitem>
                            <para><literal>src/main/webapp/</literal>  - The overlay for XMLUI Web Application. This is the location to place custom Themes or Configurations. </para>
                            <itemizedlist>
                              <listitem>
                                <para revisionflag="changed"><literal>i18n/</literal>  - The location to place a custom version of the XMLUI&apos;s messages.xml (You have to manually create this folder)</para>
                              </listitem>
                              <listitem>
                                <para><literal>themes/</literal>  - The location to place custom Themes for the XMLUI (You have to manually create this folder).</para>
                              </listitem>
                            </itemizedlist>
                          </listitem>
                        </itemizedlist>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                  <listitem>
                    <para><literal>src/</literal>  - Maven configurations for DSpace System. This directory contains the Maven and Ant build files for DSpace.</para>
                  </listitem>
                  <listitem>
                    <para><literal>target/</literal>  - (Only exists after building DSpace) This is the location Maven uses to build your DSpace installation package. </para>
                    <itemizedlist>
                      <listitem>
                        <para><literal>dspace-[version].dir</literal>  - The location of the DSpace Installation Package (which can then be installed by running <literal>ant update</literal>)</para>
                      </listitem>
                    </itemizedlist>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </para>
        </listitem>
      </itemizedlist>
    </section>
    <section remap="h2">
      <title><anchor id="docbook-directories.html-installdir" xreflabel="Installed Directory Layout"/>Installed Directory Layout</title>
      <para>Below is the basic layout of a DSpace installation using the default configuration. These paths can be configured if necessary.</para>
      <itemizedlist>
        <listitem>
          <para>
            <literal>[dspace]</literal>
            <itemizedlist>
              <listitem>
                <para><literal>assetstore/</literal>  - asset store files</para>
              </listitem>
              <listitem>
                <para><literal>bin/</literal>  - shell and Perl scripts</para>
              </listitem>
              <listitem>
                <para><literal>config/</literal>  - configuration, with sub-directories as above</para>
              </listitem>
              <listitem>
                <para><literal>handle-server/</literal>  - Handles server files</para>
              </listitem>
              <listitem>
                <para><literal>history/</literal>  - stored history files (generally RDF/XML)</para>
              </listitem>
              <listitem>
                <para><literal>lib/</literal>  - JARs, including dspace.jar, containing the DSpace classes</para>
              </listitem>
              <listitem>
                <para><literal>log/</literal>  - Log files</para>
              </listitem>
              <listitem>
                <para><literal>reports/</literal>  - Reports generated by statistical report generator</para>
              </listitem>
              <listitem>
                <para><literal>search/</literal>  - Lucene search index files</para>
              </listitem>
              <listitem>
                <para><literal>upload/</literal>  - temporary directory used during file uploads etc.</para>
              </listitem>
              <listitem>
                <para><literal>webapps/</literal>  - location where DSpace installs all Web Applications</para>
              </listitem>
            </itemizedlist>
          </para>
        </listitem>
      </itemizedlist>
    </section>
    <section remap="h2">
      <title><anchor id="docbook-directories.html-webapp" xreflabel="Contents of JSPUI Web Application"/>Contents of JSPUI Web Application</title>
      <para>DSpace&apos;s Ant build file creates a <literal>dspace-jspui-webapp/</literal> directory with the following structure:</para>
      <itemizedlist>
        <listitem>
          <para> (top level dir) </para>
          <itemizedlist>
            <listitem>
              <para> The JSPs</para>
            </listitem>
            <listitem>
              <para>
                <literal>WEB-INF/</literal>
                <itemizedlist>
                  <listitem>
                    <para><literal>web.xml</literal>  - DSpace JSPUI Web Application configuration and Servlet mappings</para>
                  </listitem>
                  <listitem>
                    <para><literal>dspace-tags.tld</literal>  - DSpace custom tag descriptor</para>
                  </listitem>
                  <listitem>
                    <para><literal>fmt.tld</literal>  - JSTL message format tag descriptor, for internationalization</para>
                  </listitem>
                  <listitem>
                    <para><literal>lib/</literal>  - All the third-party JARs and pre-compiled DSpace API JARs needed to run JSPUI</para>
                  </listitem>
                  <listitem>
                    <para><literal>classes/</literal>  - Any additional necessary class files</para>
                  </listitem>
                </itemizedlist>
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
    </section>
    <section remap="h2">
      <title><anchor id="docbook-directories.html-webapp.1" xreflabel="Contents of XMLUI Web Application (aka
Manakin)"/>Contents of XMLUI Web Application (aka Manakin)</title>
      <para>DSpace&apos;s Ant build file creates a <literal>dspace-xmlui-webapp/</literal> directory with the following structure:</para>
      <itemizedlist>
        <listitem>
          <para> (top level dir) </para>
          <itemizedlist>
            <listitem>
              <para><literal>aspects/</literal>  - Contains overarching Aspect Generator config and Prototype DRI (Digital Repository Interface) document for Manakin.</para>
            </listitem>
            <listitem>
              <para><literal>i18n/</literal>  - Internationalization / Multilingual support. Contains the <literal>messages.xml</literal> English language pack by default.</para>
            </listitem>
            <listitem>
              <para><literal>themes/</literal>  - Contains all out-of-the-box Manakin themes </para>
              <itemizedlist>
                <listitem>
                  <para><literal>Classic/</literal>  - The classic theme, which makes the XMLUI look like classic DSpace</para>
                </listitem>
                <listitem>
                  <para><literal>dri2xhtml/</literal>  - The base theme, which converts XMLUI DRI (Digital Repository Interface) format into XHTML for display</para>
                </listitem>
                <listitem>
                  <para><literal>Reference/</literal>  - The default reference theme for XMLUI</para>
                </listitem>
                <listitem>
                  <para><literal>template/</literal>  - A theme template...useful as a starting point for your own custom theme(s)</para>
                </listitem>
                <listitem>
                  <para><literal>dri2xhtml.xsl</literal>  - The DRI-to-XHTML XSL Stylesheet. Uses the above &apos;dri2xhtml&apos; theme to generate XHTML</para>
                </listitem>
                <listitem>
                  <para><literal>themes.xmap</literal>  - The Theme configuration file. It determines which theme(s) are used by XMLUI</para>
                </listitem>
              </itemizedlist>
            </listitem>
            <listitem>
              <para>
                <literal>WEB-INF/</literal>
                <itemizedlist>
                  <listitem>
                    <para><literal>lib/</literal>  - All the third-party JARs and pre-compiled DSpace JARs needed to run XMLUI</para>
                  </listitem>
                  <listitem>
                    <para><literal>classes/</literal>  - Any additional necessary class files</para>
                  </listitem>
                  <listitem>
                    <para><literal>cocoon.xconf</literal>  - XMLUI&apos;s Apache Cocoon configuration</para>
                  </listitem>
                  <listitem>
                    <para><literal>logkit.xconf</literal>  - XMLUI&apos;s Apache Cocoon Logging configuration</para>
                  </listitem>
                  <listitem>
                    <para><literal>web.xml</literal>  - XMLUI Web Application configuration and Servlet mappings</para>
                  </listitem>
                </itemizedlist>
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
    </section>
    <section remap="h2">
      <title><anchor id="docbook-directories.html-logfiles" xreflabel="Log Files"/>Log Files</title>
      <para>The first source of potential confusion is the log files. Since DSpace uses a number of third-party tools, problems can occur in a variety of places. Below is a table listing the main log files used in a typical DSpace setup. The locations given are defaults, and might be different for your system depending on where you installed DSpace and the third-party tools. The ordering of the list is roughly the recommended order for searching them for the details about a particular problem or error.</para>
      <table frame="all">
        <title>DSpace Log File Locations</title>
      	<?dbhtml table-width="100%"?>
		<?dbfo table-width="100%"?>
        <tgroup cols="2">
          <colspec colname="c1" colwidth="50*"/>
          <colspec colname="c2" colwidth="50*"/>
          <tbody>
            <row>
              <entry>
                <para>
                  <emphasis role="bold">Log File</emphasis>
                </para>
              </entry>
              <entry>
                <para>
                  <emphasis role="bold">What&apos;s In It</emphasis>
                </para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  <literal>[dspace]/log/dspace.log</literal>
                </para>
              </entry>
              <entry>
                <para>Main DSpace log file. This is where the DSpace code writes a simple log of events and errors that occur within the DSpace code. You can control the verbosity of this by editing the <literal>[dspace-source]/config/templates/log4j.properties</literal> file and then running &quot;<literal>ant init_configs</literal>&quot;.</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  <literal>[tomcat]/logs/catalina.out</literal>
                </para>
              </entry>
              <entry>
                <para>This is where Tomcat&apos;s standard output is written. Many errors that occur within the Tomcat code are logged here. For example, if Tomcat can&apos;t find the DSpace code (<literal>dspace.jar</literal>), it would be logged in <literal>catalina.out</literal>.</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  <literal>[tomcat]/logs/hostname_log.yyyy-mm-dd.txt</literal>
                </para>
              </entry>
              <entry>
                <para>If you&apos;re running Tomcat stand-alone (without Apache), it logs some information and errors for specific Web applications to this log file. <literal>hostname</literal> will be your host name (e.g. <literal>dspace.myu.edu</literal>) and <literal>yyyy-mm-dd</literal> will be the date.</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  <literal>[tomcat]/logs/apache_log.yyyy-mm-dd.txt</literal>
                </para>
              </entry>
              <entry>
                <para>If you&apos;re using Apache, Tomcat logs information about Web applications running through Apache (<literal>mod_webapp</literal>) in this log file (<literal>yyyy-mm-dd</literal> being the date.)</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  <literal>[apache]/error_log</literal>
                </para>
              </entry>
              <entry>
                <para>Apache logs to this file. If there is a problem with getting <literal>mod_webapp</literal> working, this is a good place to look for clues. Apache also writes to several other log files, though <literal>error_log</literal> tends to contain the most useful information for tracking down problems.</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  <literal>[dspace]/log/handle-plug.log</literal>
                </para>
              </entry>
              <entry>
                <para>The Handle server runs as a separate process from the DSpace Web UI (which runs under Tomcat&apos;s JVM). Due to a limitation of log4j&apos;s &apos;rolling file appenders&apos;, the DSpace code running in the Handle server&apos;s JVM must use a separate log file. The DSpace code that is run as part of a Handle resolution request writes log information to this file. You can control the verbosity of this by editing <literal>[dspace-source]/config/templates/log4j-handle-plugin.properties</literal>.</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  <literal>[dspace]/log/handle-server.log</literal>
                </para>
              </entry>
              <entry>
                <para>This is the log file for CNRI&apos;s Handle server code. If a problem occurs within the Handle server code, before DSpace&apos;s plug-in is invoked, this is where it may be logged.</para>
              </entry>
            </row>
            <row>
              <entry>
                <para>
                  <literal>[dspace]/handle-server/error.log</literal>
                </para>
              </entry>
              <entry>
                <para>On the other hand, a problem with CNRI&apos;s Handle server code might be logged here.</para>
              </entry>
            </row>
            <row>
              <entry>
                <para><literal>PostgreSQL log</literal></para>
              </entry>
              <entry>
                <para>PostgreSQL also writes a log file. This one doesn&apos;t seem to have a default location, you probably had to specify it yourself at some point during installation. In general, this log file rarely contains pertinent information--PostgreSQL is pretty stable, you&apos;re more likely to encounter problems with connecting via JDBC, and these problems will be logged in <literal>dspace.log</literal>.</para>
              </entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    	<section remap="h3">
    	<title>log4j.properties File.</title>
    		<para>the file <literal>[dspace]/config/log4j.properties</literal> controls how and where log files are created.  There are three sets of configurations in that file, called A1, A2, and A3.  These are used to control the logs for DSpace, the checksum checker, and the XMLUI respectively.   The important settings in this file are:</para>
    		<table>
    		<?dbhtml table-width="100%"?>
			<?dbfo table-width="100%"?>	
    			<title>log4j.properties Table</title>
    			<tgroup cols="2">
		          <colspec colname="c1" colwidth="50*"/>
		          <colspec colname="c2" colwidth="50*"/>
		          <tbody>
		            <row>
		              <entry><screen>log4j.rootCategory=INFO,A
log4j.logger.org.dspace=INFO,A1</screen></entry>
		            	<entry>These lines control what level of logging takes place.  Normally they should be set to INFO, but if you need to see more information in the logs, set them to dEBUG and restart your web server</entry>
		            </row>
		          	<row>
		          		<entry><literal>log4j.appender.A1=org.dspace.app.util.DailyFileAppender</literal></entry>
		          		<entry>This is the name of the log file creation method used.  The DailyFileAppender creates a new date-stamped file every day or month.</entry>
		          	</row>
		    		<row>
		    			<entry><literal>log4j.appender.A1.File=${log.dir}/dspace.log</literal></entry>
		    			<entry>This sets the filename and location of where the log file will be stored.  It iwll have a date stamp appended to the file name.</entry>
		    		</row>
		          	<row>
		          		<entry><literal>log4j.appender.A1.DatePattern=yyy-MM-DD</literal></entry>
		          		<entry>This defines the format for the date stamp that is appended to the log file names.  If you wish to have log files created monthyl instead of daily, change this to <literal>yyyy-MM</literal></entry>
		          	</row>
		          	<row>
		          		<entry><literal>log4j.appender.A1.MaxLogs=0</literal></entry>
		          		<entry>This defines how many log files will be created. You may wish to define a retention period for log files.  If you set this to 365, logs older than  a year will be deleted. By default this is set to 0 so that no logs are ever deleted. Ensure that you monitor the disk space used by the logs to make sure that you have enough space for them.  It is often important to keep the log files for a long time in case you want to rebuild your statistics.</entry>
		          	</row>
		          </tbody>
    			</tgroup>
     		</table>
    	</section>
    </section>
  </chapter>
