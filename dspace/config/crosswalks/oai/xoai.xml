<?xml version="1.0" encoding="UTF-8"?>
<!-- 

    The contents of this file are subject to the license and copyright
    detailed in the LICENSE and NOTICE files at the root of the source
    tree and available online at

    http://www.dspace.org/license/

	Developed by DSpace @ Lyncode <dspace@lyncode.com>
 -->
<Configuration indented="false" maxListIdentifiersSize="100" maxListRecordsSize="100"
               maxListSetsSize="100" stylesheet="static/style.xsl"
               xmlns="http://www.lyncode.com/XOAIConfiguration">

    <Contexts>
        <Context baseurl="request" name="Default Context">
            <!-- Restrict access to hidden items by default -->
            <Filter ref="defaultFilter" />

            <Format ref="oaidc"/>
		<!--
            <Format ref="mets"/>
            <Format ref="xoai"/>
            <Format ref="didl"/>
            <Format ref="dim"/>
            <Format ref="ore"/>
            <Format ref="rdf"/>
            <Format ref="etdms"/>
            <Format ref="mods"/>
            <Format ref="qdc"/>
            <Format ref="marc"/>
            <Format ref="uketd_dc"/>
            <Format ref="junii2" />-->
            <Description>
                This is the default context of the DSpace data provider.
            </Description>
        </Context>

        <!--
            Driver Guidelines:

            - http://www.driver-support.eu/documents/DRIVER_Guidelines_v2_Final_2008-11-13.pdf

            Page 57 - 58
         -->
        <Context baseurl="driver" name="Driver Context">
            <!-- Date format, field prefixes, etc are ensured by the transformer -->
            <Transformer ref="driverTransformer"/>
            <!-- The driver filter -->
            <Filter ref="driverFilter"/>
            <!-- Just an alias, in fact it returns all items within the driver context -->
            <Set ref="driverSet"/>
            <!-- Metadata Formats -->
            <Format ref="oaidc"/>
            <Format ref="mets"/>
            <Format ref="didl"/>
            <Description>
                This contexts complies with Driver rules.
            </Description>
        </Context>

        <!--
            OpenAIRE Guidelines 1.1:

            - http://www.openaire.eu/en/component/attachments/download/79%E2%8C%A9=en

            There is a limitation over the embargoedEndDate parameter:

            - Predefined DSpace fields don't allow to set this up with a default.
         -->
        <Context baseurl="openaire" name="OpenAIRE Context">
            <!-- Date format, field prefixes, etc are ensured by the transformer -->
            <Transformer ref="openaireTransformer"/>
            <!-- OpenAIRE filter -->
            <Filter ref="openAireFilter"/>
            <!-- Just an alias, in fact it returns all items within the driver context -->
            <Set ref="openaireSet"/>
            <!-- Metadata Formats -->
            <Format ref="oaidc"/>
            <Format ref="mets"/>
            <Description>
                This contexts complies with OpenAIRE rules.
            </Description>
        </Context>
		
		<Context baseurl="snrd">
		
			<!-- Date format, field prefixes, etc are ensured by the transformer -->
			<Transformer refid="snrdTransformer" />
            
            <!-- The snrd filter -->
            <Filter ref="snrdFilter"/>

			<!-- Just an alias, if fact it returns all items within the driver context -->
			<Set refid="snrdSet" />
			
			<!-- Metadata Formats -->
			<Format refid="oaidc" />
		</Context>

	<!-- Contexto para acceder a registros cosechables por DOAJ, en el formato de DOAJ. -->
		<Context baseurl="doaj">
			<Format refid="doaj" />
			<Format refid="xoai"/>
			<!-- Metadata mandatory : journalTitle, title, 
				fullTextUrl (sedici/handle/10915/XX - exists always), publicationDate (dc.date.issued).  -->
			<!-- JournalTitle : Mandatory-->
			<Filter refid="journalTitleExists"/>
			<!-- Pulication Date : Mandatory-->
			<Filter refid="dateExistsFilter"/>
			<!-- Title : Mandatory -->
			<Filter refid="titleExistsCondition" />
			
			<Transformer refid="doajTransformer"/>
		</Context>
    </Contexts>


    <Formats>
        <Format id="oaidc">
            <Prefix>oai_dc</Prefix>
            <XSLT>metadataFormats/oai_dc.xsl</XSLT>
            <Namespace>http://www.openarchives.org/OAI/2.0/oai_dc/</Namespace>
            <SchemaLocation>http://www.openarchives.org/OAI/2.0/oai_dc.xsd</SchemaLocation>
        </Format>
        <Format id="mets">
            <Prefix>mets</Prefix>
            <XSLT>metadataFormats/mets.xsl</XSLT>
            <Namespace>http://www.loc.gov/METS/</Namespace>
            <SchemaLocation>http://www.loc.gov/standards/mets/mets.xsd</SchemaLocation>
        </Format>
        <!-- Shows the XOAI internal generated XML -->
        <Format id="xoai">
            <Prefix>xoai</Prefix>
            <XSLT>metadataFormats/xoai.xsl</XSLT>
            <Namespace>http://www.lyncode.com/xoai</Namespace>
            <SchemaLocation>http://www.lyncode.com/schemas/xoai.xsd</SchemaLocation>
        </Format>
        <Format id="didl">
            <Prefix>didl</Prefix>
            <XSLT>metadataFormats/didl.xsl</XSLT>
            <Namespace>urn:mpeg:mpeg21:2002:02-DIDL-NS</Namespace>
            <SchemaLocation>http://standards.iso.org/ittf/PubliclyAvailableStandards/MPEG-21_schema_files/did/didl.xsd
            </SchemaLocation>
        </Format>
        <Format id="dim">
            <Prefix>dim</Prefix>
            <XSLT>metadataFormats/dim.xsl</XSLT>
            <Namespace>http://www.dspace.org/xmlns/dspace/dim</Namespace>
            <SchemaLocation>http://www.dspace.org/schema/dim.xsd</SchemaLocation>
        </Format>
        <Format id="ore">
            <Prefix>ore</Prefix>
            <XSLT>metadataFormats/ore.xsl</XSLT>
            <Namespace>http://www.w3.org/2005/Atom</Namespace>
            <SchemaLocation>http://tweety.lanl.gov/public/schemas/2008-06/atom-tron.sch</SchemaLocation>
        </Format>
        <Format id="rdf">
            <Prefix>rdf</Prefix>
            <XSLT>metadataFormats/rdf.xsl</XSLT>
            <Namespace>http://www.openarchives.org/OAI/2.0/rdf/</Namespace>
            <SchemaLocation>http://www.openarchives.org/OAI/2.0/rdf.xsd</SchemaLocation>
        </Format>
        <Format id="etdms">
            <Prefix>etdms</Prefix>
            <XSLT>metadataFormats/etdms.xsl</XSLT>
            <Namespace>http://www.ndltd.org/standards/metadata/etdms/1.0/</Namespace>
            <SchemaLocation>http://www.ndltd.org/standards/metadata/etdms/1.0/etdms.xsd</SchemaLocation>
        </Format>
        <Format id="mods">
            <Prefix>mods</Prefix>
            <XSLT>metadataFormats/mods.xsl</XSLT>
            <Namespace>http://www.loc.gov/mods/v3</Namespace>
            <SchemaLocation>http://www.loc.gov/standards/mods/v3/mods-3-1.xsd</SchemaLocation>
        </Format>
        <Format id="qdc">
            <Prefix>qdc</Prefix>
            <XSLT>metadataFormats/qdc.xsl</XSLT>
            <Namespace>http://purl.org/dc/terms/</Namespace>
            <SchemaLocation>http://dublincore.org/schemas/xmls/qdc/2006/01/06/dcterms.xsd</SchemaLocation>
        </Format>
        <Format id="marc">
            <Prefix>marc</Prefix>
            <XSLT>metadataFormats/marc.xsl</XSLT>
            <Namespace>http://www.loc.gov/MARC21/slim</Namespace>
            <SchemaLocation>http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd</SchemaLocation>
        </Format>
        <Format id="uketd_dc">
            <Prefix>uketd_dc</Prefix>
            <XSLT>metadataFormats/uketd_dc.xsl</XSLT>
            <Namespace>http://naca.central.cranfield.ac.uk/ethos-oai/2.0/</Namespace>
            <SchemaLocation>http://naca.central.cranfield.ac.uk/ethos-oai/2.0/uketd_dc.xsd</SchemaLocation>
            <Filter ref="uketdDcFilter"/>
        </Format>
        <Format id="junii2">
            <Prefix>junii2</Prefix>
            <XSLT>metadataFormats/junii2.xsl</XSLT>
            <Namespace>http://irdb.nii.ac.jp/oai</Namespace>
            <SchemaLocation>http://irdb.nii.ac.jp/oai/junii2-3-1.xsd</SchemaLocation>
        </Format>
		<Format id="doaj">
			<Prefix>doaj</Prefix>
			<XSLT>metadataFormats/doaj_mtd.xsl</XSLT>
			<Namespace>http://doaj.org/</Namespace>
			<SchemaLocation>http://doaj.org/static/doaj/doajArticles.xsd</SchemaLocation>
		</Format>
    </Formats>

    <Transformers>
        <Transformer id="driverTransformer">
            <XSLT>transformers/driver.xsl</XSLT>
        </Transformer>
        <Transformer id="openaireTransformer">
            <XSLT>transformers/openaire.xsl</XSLT>
        </Transformer>
		<Transformer id="snrdTransformer">
			<XSLT>transformers/snrd.xsl</XSLT>
		</Transformer>
		<Transformer id="doajTransformer">
			<XSLT>transformers/doaj_tfm.xsl</XSLT>
		</Transformer>
    </Transformers>


    <Filters>
        <Filter id="driverFilter">
            <Definition>
                <And>
                    <LeftCondition>
                        <And>
                            <LeftCondition>
                                <Custom ref="titleExistsCondition"/>
                            </LeftCondition>
                            <RightCondition>
                                <Custom ref="authorExistsCondition"/>
                            </RightCondition>
                        </And>
                    </LeftCondition>
                    <RightCondition>
                        <And>
                            <LeftCondition>
                                <Custom ref="driverDocumentTypeCondition"/>
                            </LeftCondition>
                            <RightCondition>
                                <And>
                                    <LeftCondition>
                                        <Or>
                                            <LeftCondition>
                                                <Custom ref="bitstreamAccessCondition"/>
                                            </LeftCondition>
                                            <RightCondition>
                                                <Custom ref="externalResourceAccessCondition"/>
                                            </RightCondition>
                                        </Or>
                                    </LeftCondition>
                                    <RightCondition>
                                        <Custom ref="driverAccessCondition"/>
                                    </RightCondition>
                                </And>
                            </RightCondition>
                        </And>
                    </RightCondition>
                </And>
            </Definition>
        </Filter>

        <Filter id="openAireFilter">
            <Definition>
                <And>
                    <LeftCondition>
                        <And>
                            <LeftCondition>
                                <Custom ref="titleExistsCondition"/>
                            </LeftCondition>
                            <RightCondition>
                                <Custom ref="authorExistsCondition"/>
                            </RightCondition>
                        </And>
                    </LeftCondition>
                    <RightCondition>
                        <Custom ref="driverDocumentTypeCondition"/>
                    </RightCondition>
                </And>
            </Definition>
            <!-- 
            Desactivamos la validacion de dc.relation ya que 
            no usamos Project Identifier en nuestro repositorio. 
			<Custom ref="openaireRelationFilter"/>
			-->
        </Filter>

        <Filter id="uketdDcFilter">
            <Definition>
                <Custom ref="thesisDocumentTypeCondition"/>
            </Definition>
		</Filter>
		
        <Filter id="snrdFilter">
            <Definition>
                <And>
                    <LeftCondition>
                        <And>
                            <LeftCondition>
                                <!-- Regla 4 -->
                                <Custom ref="titleExistsCondition"/>
                            </LeftCondition>
                            <RightCondition>
                            	<!-- Regla 5 -->
                                <Custom ref="authorExistsCondition"/>
                            </RightCondition>
                        </And>
                    </LeftCondition>
                    <RightCondition>
                        <And>
                            <LeftCondition>
                                <Custom ref="snrdDocumentTypeCondition"/>
                            </LeftCondition>
                            <RightCondition>
                                <And>
                                    <LeftCondition>
                                        <Or>
                                            <LeftCondition>
                                                <Custom ref="bitstreamAccessCondition"/>
                                            </LeftCondition>
                                            <RightCondition>
                                                <Custom ref="externalResourceAccessCondition"/>
                                            </RightCondition>
                                        </Or>
                                    </LeftCondition>
                                    <RightCondition>
                                        <Custom ref="driverAccessCondition"/>
                                    </RightCondition>
                                </And>
                            </RightCondition>
                        </And>
                    </RightCondition>
                </And>
                <!-- OTROS TBD -->
                <!-- Regla 3 
				<Filter refid="fulltextOnlyFilter"/>-->
                <!-- Regla 7 
				<Filter refid="directorExisteParaTesisFilter"/> -->
            </Definition>
        </Filter>

        <Filter id="uketdDcFilter">
            <Definition>
                <Custom ref="thesisDocumentTypeCondition"/>
            </Definition>
        </Filter>

        <Filter id="defaultFilter">
            <Definition>
                <Custom ref="bitstreamAccessCondition"/>
            </Definition>
        </Filter>

        <CustomCondition id="thesisDocumentTypeCondition">
            <Class>org.dspace.xoai.filter.DSpaceAtLeastOneMetadataFilter</Class>
            <Configuration>
                <string name="field">dc.type</string>
                <string name="operator">contains</string>
                <string name="value">Tesis</string>
            </Configuration>
        </CustomCondition>

        <CustomCondition id="authorExistsCondition">
            <Class>org.dspace.xoai.filter.DSpaceMetadataExistsFilter</Class>
            <Configuration>
                <list name="fields">
	    			<Value>dc.contributor.author</Value>
                    <Value>sedici.creator.person</Value>
				    <Value>sedici.creator.corporate</Value>
				    <Value>sedici.creator.interprete</Value>
				    <Value>sedici.contributor.compiler</Value>
				    <Value>sedici.contributor.coordinator</Value>
				    <Value>sedici.contributor.editor</Value>
				    <Value>sedici.contributor.translator</Value>\
                </list>
            </Configuration>
        </CustomCondition>

        <CustomCondition id="titleExistsCondition">
            <Class>org.dspace.xoai.filter.DSpaceMetadataExistsFilter</Class>
            <Configuration>
                <string name="field">dc.title</string>
            </Configuration>
        </CustomCondition>

		<!-- Dejamos tanto objetos textuales como no textuales. Instrumento musical no se exporta -->
        <CustomCondition id="driverDocumentTypeCondition">
            <Class>org.dspace.xoai.filter.DSpaceAtLeastOneMetadataFilter</Class>
            <Configuration>
                <string name="field">sedici.subtype</string>
                <string name="operator">equal</string>
                <list name="values">
					<string>Documento de trabajo</string>
					<string>Preprint</string>
					<string>Articulo</string>
					<string>Comunicacion</string>
					<string>Revision</string>
					<string>Contribuciones a revistas</string>
					<string>Reporte</string>
					<string>Patente</string>
					<string>Tesis de doctorado</string>
					<string>Tesis de maestria</string>
					<string>Tesis de grado</string>
					<string>Libro</string>
					<string>Capitulo de libro</string>
					<string>Objeto de conferencia</string>
					<string>Documento institucional</string>
					<string>Resolucion</string>
					<string>Imagen fija</string>
					<string>Imagen en movimiento</string>
					<string>Audio</string>
					<string>Entrevista</string>
					<string>Musica</string>
					<string>Discurso</string>
					<string>Testimonio</string>
					<string>Clase</string>
					<string>Trabajo practico</string>
					<string>Material complementario</string>
					<string>Programa</string>
					<string>Resumen</string>
					<string>Edicion de Revista</string>
					<string>Boletin</string>
                </list>
            </Configuration>
        </CustomCondition>

        <CustomCondition id="driverAccessCondition">
            <Class>org.dspace.xoai.filter.DSpaceAtLeastOneMetadataFilter</Class>
            <Configuration>
                <string name="field">dc.rights</string>
                <string name="operator">contains</string>
                <list>
                    <string>open access</string>
                    <string>openAccess</string>
                </list>
            </Configuration>
        </CustomCondition>

        <CustomCondition id="bitstreamAccessCondition">
            <Class>org.dspace.xoai.filter.DSpaceAuthorizationFilter</Class>
        </CustomCondition>

        <CustomCondition id="openaireRelationCondition">
            <Class>org.dspace.xoai.filter.DSpaceAtLeastOneMetadataFilter</Class>
            <Configuration>
                <string name="field">dc.relation</string>
                <string name="operator">starts_with</string>
                <string name="value">info:eu-repo/grantAgreement/EC/FP</string>
            </Configuration>
        </CustomCondition>

		<CustomCondition id="dateExistsFilter">
			<Class>org.dspace.xoai.filter.DSpaceMetadataExistsFilter</Class>
			<Configuration>
                <string name="field">dc.date</string>
			</Configuration>
		</CustomCondition>
		
		<CustomCondition id="journalTitleExists">
			<Class>org.dspace.xoai.filter.DSpaceMetadataExistsFilter</Class>
			<Configuration>
                <string name="field">sedici.relation.journalTitle</string>
			</Configuration>
		</CustomCondition>
		
		<CustomCondition id="snrdDocumentTypeCondition">
			<Class>org.dspace.xoai.filter.DSpaceAtLeastOneMetadataFilter</Class>
			 <Configuration>
                <string name="field">sedici.subtype</string>
                <string name="operator">equal</string>
                <list>
                    <string>Articulo</string>
    				<string>Documento de trabajo</string>
	    			<string>Revision</string>
		    		<string>Reporte</string>
			    	<string>Patente</string>
				    <string>Tesis de doctorado</string>
    				<string>Tesis de maestria</string>
	    			<string>Trabajo de especializacion</string>
		    		<string>Trabajo final de grado</string>
			    	<string>Tesis de grado</string>
    				<string>Libro</string>
	    			<string>Capitulo de libro</string>
		    		<string>Objeto de conferencia</string>
			    	<string>Resumen</string>
				    <string>Edicion de revista</string>
    				<string>Boletin</string>
    			</list>
			</Configuration>
		</CustomCondition>
		
		<CustomCondition id="fulltextOnlyFilter">
			<Class>org.dspace.xoai.filter.DSpaceAtLeastOneMetadataFilter</Class>
			<Configuration>
                <string name="field">sedici.description.fulltext</string>
                <string name="operator">equal</string>
                <list>
                    <string>true</string>
					<string>si</string>
				</list>
			</Configuration>
		</CustomCondition>

		<!-- Sólo se considera fecha de publicación o de exposición (en el caso de las tesis) -->
		<CustomCondition id="dateExistsFilter">
			<Class>org.dspace.xoai.filter.DSpaceMetadataExistsFilter</Class>
			<Configuration>
                <list name="fields">
	    			<Value>sedici.date.exposure</Value>
					<Value>dc.date.issued</Value>
				</list>
			</Configuration>
		</CustomCondition>
		
        <CustomCondition id="externalResourceAccessCondition">
            <Class>org.dspace.xoai.filter.DSpaceMetadataExistsFilter</Class>
            <Configuration>
                <string name="field">sedici.identifier.uri</string>
            </Configuration>
        </CustomCondition>

	</Filters>

    <Sets>
        <Set id="driverSet">
            <Spec>driver</Spec>
            <Name>Open Access DRIVERset</Name>
            <!-- Just an alias -->
        </Set>
        <Set id="openaireSet">
            <Spec>ec_fundedresources</Spec>
            <Name>EC_fundedresources set</Name>
            <!-- Just an alias -->
        </Set>
        <Set id="snrdSet">
            <Spec>snrd</Spec>
            <Name>Conjunto de recursos para Sistema Nacional de Repositorios Digitales, Argentina SNRD</Name>
            <!-- Just an alias -->
        </Set>
    </Sets>
</Configuration>
